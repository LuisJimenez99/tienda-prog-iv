{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
  <!-- 1. Librería Flatpickr (El motor del calendario visual) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  
  <!-- Estilos modernos para Flatpickr (Tema Airbnb) -->
  <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/airbnb.css">

  <!-- 2. Nuestros estilos personalizados para la agenda -->
  <link rel="stylesheet" href="{% static 'css/pages/calendario.css' %}">
{% endblock %}

{% block content %}
<div class="agenda-wrapper">
    
    <!-- ENCABEZADO -->
    <div class="agenda-header">
        <h1>Reservar Turno</h1>
        <p>Selecciona un día disponible en el calendario para ver los horarios de consulta.</p>
    </div>

    <!-- CONTENEDOR PRINCIPAL (2 COLUMNAS) -->
    <div class="agenda-container">
        
        <!-- COLUMNA 1: CALENDARIO INTERACTIVO -->
        <div class="col-calendario">
            <!-- Aquí Flatpickr inyectará el calendario -->
            <div id="inline-calendar"></div>
        </div>

        <!-- COLUMNA 2: HORARIOS DISPONIBLES -->
        <div class="col-horarios">
            <div class="horarios-header">
                <!-- Título dinámico (ej: "Viernes 12 de Octubre") -->
                <h3 id="fecha-seleccionada-titulo">Selecciona una fecha</h3>
                
                <!-- Spinner de carga (oculto por defecto) -->
                <span id="estado-loading" class="loading-spinner" style="display:none;">
                    <i class="fas fa-circle-notch fa-spin"></i> Buscando...
                </span>
            </div>

            <!-- Grilla donde se dibujarán los botones de hora -->
            <div id="lista-horarios" class="grid-horarios">
                <div class="empty-state-horarios">
                    <i class="far fa-calendar-alt"></i>
                    <p>Elige un día en el calendario para ver la disponibilidad.</p>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- 
    FORMULARIO OCULTO 
    Este form no se ve, pero es el que JS llenará y enviará al backend 
    cuando el usuario haga clic en un horario.
-->
<form id="form-reserva" method="POST" action="{% url 'reservar_turno' %}" style="display:none;">
    {% csrf_token %}
    <input type="hidden" name="fecha" id="input-fecha">
    <input type="hidden" name="hora" id="input-hora">
</form>

{% endblock %}

{% block extra_js %}
<!-- Lógica JS para conectar todo -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://npmcdn.com/flatpickr/dist/l10n/es.js"></script> <!-- Idioma Español -->
<script src="{% static 'js/calendario.js' %}"></script>
{% endblock %}